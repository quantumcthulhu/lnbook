[[getting-started]]
== Починаємо

У цьому розділі ми почнемо з того, з чого починають більшість людей, коли вперше стикаються з Lightning Network - із вибору програмного забезпечення для участі в економіці Lightning Network. На прикладі двох користувачів ми розглянемо звичайний випадок використання Lightning Network. Клієнтка кав'ярні Аліса використовуватиме Lightning-гаманець на своєму мобільному пристрої, щоб купувати каву в кафе Боба. Торговець Боб буде використовувати Lightning-ноду і гаманець для отримання платежів у своєму кафе через Lightning Network.

=== Lightning-Ноди

Доступ до Lightning Network здійснюється за допомогою програм, які вміють спілкуватися через протокол Lightning Network. _Нода Lightning Network_ (або просто "нода") - це програмний застосунок, що має три важливі характеристики. По-перше, ноди взаємодіють peer-to-peer з іншими Lightning-нодами, утворюючи мережу. Також ноди мають функціональність "гаманця", тобто вони можуть надсилати та отримувати платежі через Lightning Network, як гаманці у мережі Біткоїн. Нарешті, Lightning-нодам потрібен доступ до блокчейну Біткоїна (або інших блокчейнів для інших криптовалют) для гарантування безпеки коштів, які беруть участь в платежах.

Користувачі мають найвищий рівень контролю, коли використовують власні  Біткоїн- та Lightning- ноди. Також Lightning-ноди можуть використовувати для взаємодії з Біткоїн-блокчейном полегшену Біткоїн-ноду, що відома як Simplified Payment Verification (Спрощена Верифікація Платежів, SPV).

=== Lightning-Експлорер

Експлорер (Провідник, Explorer) Lightning Network - це корисний інструмент для відображення статистики нод, каналів та об'єму мережі.

Нижче наведено невичерпний перелік (в алфавітно-цифровому порядку):

* https://1ml.com/, 1ML Lightning-експлорер
* https://explorer.acinq.co/, Lightning-експлорер від ACINQ з гарною візуалізацією 
* https://lightblock.me/, Lightblock Lightning-експлорер
* https://hashxp.org/lightning/node/, hashXP Lightning-експлорер

[TIP]
====
Зверніть увагу, що при використанні Lightning-експлорерів, як і випадку з блокчейн-експлорерами,
конфіденційність користувачів може постраждати, так як веб-сайт може відстежувати їхні IP-адреси та збирати інформацію про поведінку користувачів (наприклад, ноди, якими вони цікавились).

Також варто зазначити, що, оскільки не існує глобального консенсусу ані щодо поточного графу Lightning, ані щодо поточного стану будь-якої існуючої політики каналів, користувачі ніколи не повинні покладатися на Lightning-експлорери для отримання актуальної інформації. Lightning-експлорери слід використовувати лише для збору широкої статистики Lightning Network.
====

=== Lightning-Гаманці

Термін "Lightning-гаманець" є дещо неоднозначним, оскільки він може описувати широкий спектр компонентів у поєднанні з інтерфейсом користувача. До найпоширеніших складових частин Lightning-гаманця належать:

* Сховище ключів для зберігання секретних ключів.
* Lightning-нода, що спілкується через peer-to-peer мережу, як було описано вище.
* Біткоїн-нода, що зберігає блокчейн та спілкується з іншими Біткоїн-нодами.
* "Карта" нод і каналів, що анонсовані у Lightning Network.
* "Пліткар", який збирає інформацію про ноди і канали в мережі для побудови "мапи" мережі.
* Сховище для зберігання інформації про відкриті канали.
* Менеджер каналів, який може відкривати та закривати канали.
* Система пошуку маршруту з'єднаних каналів від джерела платежу до призначення платежу.

Lightning-гаманець може виконувати всі ці функції, будучи "повним" гаманцем, незалежним від сторонніх сервісів. Або одна чи кілька з перерахованих функцій може повністю або частково перекладатися на сторонні сервіси.

Ключова відмінність (гра слів) полягає в тому, виконує гаманець функцію зберігання ключів чи покладає її на сторонній сервіс. В блокчейнах контроль над ключами визначає контроль над монетами, що виражається у вислові "твої ключі - твої монети; не твої ключі - не твої монети". Всякий гаманець, який передає управління ключами на аутсорсинг, називається "кастодіальним" (від англ. "custody" - "зберігання", "охорона"), оскільки сторона, яка зберігає ключі, контролює кошти користувача, а не сам користувач. Відповідно, "некастодіальним" або "само-кастодіальним" називають такий гаманець, що самостійно виконує функцію зберігання ключів, і ключі контролюються лише користувачем. Термін "некастодіальний" гаманець просто означає, що сховище ключів є локальним і знаходиться під контролем користувача. При цьому один або більше функцій гаманця (крім сховища ключів) можуть бути передані довіренним стороннім сервісам.

Блокчейни, особливо відкриті блокчейни, такі як Біткоїн, намагаються мінімізувати або взагалі усунути необхідність довіри до третіх сторін і передати повноваження самим користувачам. Цю модель часто називають "trustless" (без довіри), хоча більш підходящим словосполученням є "модель з мінімізованою довірою". В таких системах користувач довіряє правилам програмного забезпечення замість довіри до третіх осіб. Таким чином питання контролю над ключами є головним фактором при виборі Lightning-гаманця.

Кожен компонент Lightning-гаманця викликає подібні міркування щодо довіри. Якщо всі компоненти перебувають під контролем користувача, тоді довіра до третіх сторін зводиться до мінімуму, забезпечуючи максимальну владу користувача. Звісно, разом із такою владою виникає відповідальність користувача за управління складним програмним забезпеченням.

Кожен користувач повинен враховувати власні технічні навички, перш ніж вирішити, який тип гаманця використовувати. Тим, хто має сильні технічні навички, слід користуватись гаманцем Lightning, який передає всі функції під безпосередній контроль користувача. Тим, у кого менше технічних навичок, але є бажання контролювати свої кошти, слід обрати _некастодіальний_ Lightning-гаманець.
Часто довіра у цих випадках стосується конфіденційності.
Коли користувачі вирішують передати деякі функції третій стороні, то вони, як правило, частково втрачають конфіденційність, оскільки третя сторона дізнається деяку інформацію про них.

Нарешті, ті, хто прагне простоти та зручності, навіть за рахунок контролю та безпеки, можуть вибрати кастодіальний Lightning-гаманець. Це найпростіший варіант, але він _підриває модель довіри криптовалюти_ і, отже, його слід розглядати лише як сходинку до більшого контролю та незалежності.

Існує багато способів охарактеризувати або класифікувати гаманці.
Найважливішими є такі питання:

- Цей Lightning-гаманець утримує свою повну Lightning-ноду чи він використовує сторонню Lightning-ноду?
- Цей Lightning-гаманець утримує свою повну Біткоїн-ноду чи він використовує сторонню Біткоїн-ноду? footnote:[Якщо Lightning-гаманець використовує сторонню Lightning-ноду, то ця стороння Lightning-нода вирішує, як їй спілкуватися з мережею Біткоїн. Отже, використання сторонньої Lightning-ноди автоматично означає використання і сторонньої Біткоїн-ноди. Лише в протилежному випадку - коли Lightning-гаманець використовує власну Lightning-ноду - існує вибір "власна Біткоїн-нода" чи "стороння Біткоїн-нода". ]
- Цей Lightning-гаманець зберігає ключі під контролем користувача, або ключі зберігаються у стороннього кастодіала?

На найвищому рівні абстракції питання 1 і 3 є найбільш елементарними.
З цих двох питань ми можемо вивести чотири можливі категорії.
Ми можемо розмістити ці чотири категорії в квадранті, як показано в Таблиці <<lnwallet-categories>>.
Але пам’ятайте, що це лише один із способів класифікувати Lightning-гаманці.

[[lnwallet-categories]]
.Квадрант Lightning-Гаманців
[options="header"]
|===
|                        | *Повна Lightning-нода*      | *Стороння Lightning-нода*
| *Некастодіальний*         | Q1: Сильні технічні навички, найменша довіра до третіх сторін, потребує найменше дозволів | Q2: Технічні навички нижче середнього, довіра до третіх сторін нижче середнього, потребує деяких дозволів
| *Кастодіальний*            | Q3: Технічні навички вище середнього, довіра до третіх сторін вище середнього, потребує деяких дозволів | Q4: Слабкі технічні навички, найбільша довіра до третіх сторін, потребує найбільше дозволів
|===

Ситуація визначена у квадранті Q3, коли у гаманця є власна Lightning-нода, але ключі знаходяться у кастодіала, на данний момент не трапляється. 
Майбутні гаманці із цього квадранта дозволять користувачеві турбуватися про операційні аспекти своєї ноди, але делегуватимуть доступ до ключів третій стороні, яка може використовувати переважно холодне зберігання ключів.

Lightning-гаманці можна встановити на різні пристрої, включаючи ноутбуки, сервери та мобільні пристрої. Щоб запустити повну Lightning-ноду (ту, що бере участь у "плітках" і створює власну карту мережі для пошуку та маршрутизації шляхів), вам потрібно буде використовувати сервер або настільний комп'ютер, оскільки мобільні пристрої та ноутбуки зазвичай недостатньо потужні в сенсі ємності, швидкості обробки, часу автономної роботи та підключення до мережі.

Категорія "Сторонні Lightning-ноди" може бути поділена на:

- Легкі: Lightning-нода управляється третьою стороною, гаманець отримує необхідну інформацію від сторонньої Lightning-ноди через API.
- Ніякі: означає, що не тільки Lightning-нода управляється третьою стороною, але й більшою частиною гаманця керує третя сторона, розташована в клауді, так що гаманцю навіть не потрібно викликати API.

Ці підкатегорії використані в таблиці <<lnwallet-examples>>.

Інші терміни, які потребують пояснення в Таблиці <<lnwallet-examples>> у стовпці "Біткоїн-нода":

- Neutrino: Neutrino - це специфічна реалізація протоколу для отримання даних з Біткоїн-мережі, згідно BIP 157 і BIP 158. Біткоїн-нода управляється третьою стороною і доступ до неї здійснюється за допомогою "neutrino".
- Electrum: Це означає, що гаманець підключається до сервера Electrum. Біткойн-нода управляється третьою стороною і доступ до неї здійснюється за протоколом "Electrum".
- Bitcoin Core: реалізація повної Біткоїн-ноди.
- btcd: інша реалізація повної Біткоїн-ноди.

У <<lnwallet-examples>> ми бачимо кілька прикладів популярних на даний момент гаманців для різних типів пристроїв.

// TODO: Add a lot more wallet/node examples, confirm the details for correctness
[[lnwallet-examples]]
.Приклади Популярних Lightning-Гаманців
[options="header"]
|===
| Застосунок    | Пристрій  | Lightning-нода | Біткоїн-нода          | Сховище ключів
| lnd            | Сервер  | Повна нода   | Bitcoin Core/btcd     | Некастодіальне
| c-lightning    | Сервер  | Повна нода   | Bitcoin Core          | Некастодіальне
| Eclair Server  | Сервер  | Повна нода   | Bitcoin Core/Electrum | Некастодіальне
| Zap Desktop    | Настільний комп'ютер | Повна нода   | Neutrino              | Некастодіальне
| Eclair Mobile  | Смартфон  | Легка нода | Electrum              | Некастодіальне
| Breez Wallet   | Смартфон  | Повна нода   | Neutrino              | Некастодіальне
| Phoenix Wallet | Смартфон  | Легка нода | Electrum              | Некастодіальне
| Blue Wallet    | Смартфон  | Ніяка        | Ніяка                  | Кастодіальне
|===

=== Баланс між складністю та контролем

Lightning-гаманці мають дотримуватися балансу між складністю для користувача та ступнем контролю з його боку. Ті гаманці, що дають користувачеві найбільший контроль над коштами, найвищий ступінь конфіденційності та найбільшу незалежність від сторонніх сервісів, завжди є більш складними та важкими у використанні. По мірі розвитку технології деякі з цих компромісів ставатимуть менш суворими, і користувачі зможуть отримати більший контроль без більшої складності. Наразі різні компанії та проекти випробовують різні варіанти у всьому спектрі відношень складність/контроль та намагаються знайти «солодке місце» для своєї цільової користувацької аудиторії.

Обираючи гаманець, майте на увазі, що навіть якщо ви не бачите цих компромісів, вони все одно існують. Наприклад, багато гаманців намагаються зняти тягар управління каналами з користувачів. Для цього вони запроваджують центральні хаби, до яких автоматично підключаються всі їхні гаманці. Хоча цей компроміс спрощує інтерфейс та досвід взаємодії користувача із системою, він запроваджує єдину точку відмови (Single Point of Failure, SPoF), оскільки ці "хаби" стають необхідними для роботи гаманця. Крім того, якщо покластися на такий "хаб", це може зменшити конфіденційність користувачів, оскільки хаб знає відправника та потенційно (якщо будує маршрут оплати від імені користувача) також одержувача кожного платежу, здійсненого гаманцем користувача.

У наступному розділі ми повернемося до нашої першої користувачки та прослідкуємо за її першим встановленням Lightning-гаманця. Вона обрала гаманець, який є більш складним, ніж прості кастодіальні гаманці. Це дозволить нам продемонструвати деякі складності, які стоять за ним, та ознайомитись із внутрішніми процесами просунутого гаманця з нашого прикладу. Ви можете прийти до висновку, що ваш перший ідеальний гаманець має бути ближчим до "простоти використання", прийнявши деякі компроміси щодо контролю та конфіденційності. Або, можливо, ви більш "досвідчений користувач" і забажаєте запустити власні ноди Lightning та Біткоїн.

=== Перший Lightning-Гаманець Аліси

Аліса - досвідчений користувач Біткоїна. Вперше ми познайомилися з Алісою в главі 1 _"Освоєння Біткоїна"_ footnote:["Освоєння Біткоїна 2-е видання, глава 1" Андреас М. Антонопулос (https://github.com/bitcoinbook/bitcoinbook/blob/develop/ch01.asciidoc ).], коли вона придбала чашку кави в Кафе Боба за допомогою біткоїн-транзакції. Зараз Аліса прагне експериментувати з Lightning Network. Спочатку вона повинна обрати Lightning-гаманець, який би відповідав її потребам.

Аліса не хоче довіряти зберігання своїх біткоїнів третім особам. Вона дізналася достатньо про криптовалюту, щоб вміти користуватись гаманцем. Також вона хоче мати мобільний гаманець, щоб використовувати його для невеликих платежів. Тому вона обирає гаманець _Eclair_, популярний мобільний некастодіальний Lightning-гаманець.

==== Скачування та Встановлення Lightning-Гаманця

Шукаючи новий криптовалютний гаманець, ви маєте дуже обережно обирати безпечні джерела програмного забезпечення.

На жаль, є дуже багато фальшивих гаманців, які вкрадуть ваші гроші, а деякі з них навіть трапляються на надійних та нібито перевірених сайтах програмного забезпечення, таких як магазини застосунків Apple і Google. Незалежно від того, встановлюєте ви перший або десятий свій гаманець, завжди будьте максимально обережні. Шкідливий застосунок може не тільки вкрасти гроші, які ви йому довірите, але й також вкрасти ключі та паролі від інших програм, скомпрометувавши операційну систему вашого пристрою.

У Аліси Android-пристрій і вона використовуватиме Google Play Store для завантаження та встановлення гаманця Eclair. В пошуку Google Play вона знаходить "Eclair Mobile", як показано на зображенні <<eclair-playstore>>.

[[eclair-playstore]]
.Eclair Mobile в Google Play Store
image:images/eclair-playstore.png["Eclair wallet in the Google Play Store"]

Аліса помічає на цій сторінці кілька різних елементів, які допомагають їй переконатися, що це, скоріш за все, правильний гаманець "Eclair Mobile", який вона шукала. По-перше, організація "ACINQ" footnote:[ACINQ: Розробники гаманця Eclair Mobile Lightning (https://acinq.co/).] вказана як розробник цього мобільного гаманця, про цю організацію Аліса знає із свого попереднього дослідження. По-друге, гаманець був встановлений "10 000+" разів і має понад 320 позитивних відгуків. Навряд чи це шкідлива програма, яка прокралася до Play Store. По-третє, Аліса переходить на веб-сайт ACINQ (https://acinq.co/). Вона перевіряє, чи захищена веб-сторінка (https, а не http), що деякі браузери відображають у вигляді зеленого замка. На веб-сайті вона переходить у розділ "Download" або шукає посилання на магазин застосунків Google. Вона знаходить посилання і клацає по ньому. Вона перевіряє, що це посилання веде на ту ж саму програму в Google App Store. Задоволена проведеним аналізом, Аліса встановлює застосунок Eclair на свій мобільний пристрій.

[WARNING]
====
Завжди будьте вкрай обережні, встановлюючи програмне забезпечення на будь-який пристрій. Існує багато фальшивих гаманців для криптовалют, які не тільки вкрадуть ваші гроші, але й можуть скомпрометувати всі інші застосунки на вашому пристрої.
====

=== Створення Нового Гаманця

Коли Аліса вперше відкриває додаток Eclair Mobile, їй пропонується вибір «Створити новий гаманець» або «Імпортувати існуючий гаманець». Аліса створить новий гаманець, але давайте спочатку обговоримо, чому ці опції представлені тут і що означає «імпортувати існуючий гаманець».

==== Відповідальність за Зберігання Ключів

Як ми вже згадували на початку цього розділу, Eclair - це некастодіальний гаманець, тобто лише Аліса має право зберігання ключів, які використовуються для управління біткоїнами. Це також означає, що лише Аліса відповідальна за захист і резервне копіювання своїх ключів. Якщо Аліса втратить ключі, ніхто не зможе допомогти їй повернути втрачені назавжди біткоїни.

[WARNING]
====
За допомогою гаманця Eclair Mobile Аліса зберігає та контролює ключі, а отже, і несе повну відповідальність за збереження та резервне копіювання ключів. Якщо вона втратить ключі, вона втратить біткоїни, і ніхто не зможе допомогти їй оговтатися від цієї втрати!
====

==== Мнемонічні Слова

Подібно до більшості біткоїн-гаманців, Eclair Mobile пропонує _мнемонічну фразу_ для резервного копіювання. Мнемонічна фраза складається з 24 англійських слів, вибраних програмою випадковим чином, із цієї фоази генеруються всі ключі для гаманця. Мнемонічна фраза може бути використана Алісою для відновлення всіх транзакцій та коштів у гаманці Eclair Mobile на той випадок, якщо мобільний пристрій буде втрачено, пошкоджено або трапиться помилка у програмному забезпеченні.

[TIP]
====
_Мнемонічну фразу_ часто помилково називають "seed" ("зерно"). Насправді зерно будується _з мнемонічної фрази_ та є дещо іншою штукою.
====

Коли Аліса вирішить "Створити новий гаманець", їй буде показаний екран із її мнемонічною фразою, як показано на скріншоті <<eclair-mnemonic>>.

[[eclair-mnemonic]]
.Мнемонічна Фраза Нового Гаманця
image:images/eclair-mnemonic.png["New Wallet Mnemonic Phrase"]

В <<eclair-mnemonic>> ми навмисно затерли частину мнемонічної фрази, щоб запобігти повторному використанню читачами цієї фрази.

[[mnemonic-storage]]
==== Безпечне Зберігання Мнемонічної Фрази

Алісі потрібно обережно зберігати мнемонічну фразу так, щоб вона не була вкрадена або випадково загублена. Щоб збалансувати ці ризики, рекомендуємо написати дві копії мнемонічної фрази на папері, причому пронумерувати слова, так як порядок слів має значення.

Після того, як Аліса записала мнемонічну фразу і натиснула кнопку "OK, GOT IT", їй буде запропоновано _тест_, щоб переконатися, що вона правильно записала мнемонічну фразу. Тест просить ввести три-чотири слова із фрази. Аліса не очікувала на тест, але оскільки вона правильно записала мнемонічну фразу, вона проходить його без особливих труднощів.

Після того, як Аліса записала мнемонічну фразу та пройшла тест, вона має зберігати кожну копію в окремому надійному місці, наприклад, у закритій шухляді письмового столу або у вогнетривкому сейфі.

[WARNING]
====
Ніколи не намагайтеся вигадати власну схему безпеки, яка будь-яким чином відхиляється від рекомендованої найкращої практики в <<mnemonic-storage>>. Не розрізайте мнемонічну фразу навпіл, не робіть скріншоти, не зберігайте її на USB-накопичувачах чи у "хмарі", не шифруйте її та не використовуйте будь-який інший нестандартний метод. Цим ви перехилите баланс таким чином, що зростуть ризики втрати або крадіжки. Багато людей втратили кошти не через крадіжку, а через те, що спробували нестандартне рішення, не маючи достатнього досвіду, щоб збалансувати пов'язані ризики. Рекомендації щодо найкращих практик ретельно збалансовані експертами та підходять для переважної більшості користувачів.
====

Після того, як Аліса ініціалізує свій гаманець Eclair Mobile, вона побачить коротку довідку, яка висвітлює різні елементи інтерфейсу користувача. Ми не будемо повторювати довідку тут, але ми виконаємо всі кроки, необхідні для того, щоб Аліса купила чашку кави!

=== Завантаження Біткоїнів у Гаманець

Зараз у Аліси є Lightning-гаманець, але він порожній! Тепер вона стикається з одним із найскладніших аспектів експерименту: вона повинна знайти спосіб придбати трохи біткоїнів і покласти їх до свого гаманця Eclair.

[[acquiring-bitcoin]]
==== Придбання Біткоїнів

Є кілька способів придбати біткоїни:

* Обміняти національну валюту (наприклад, долари США) на біткоїни на криптовалютній біржі
* Придбати біткоїни у друга або знаймого з Біткоїн Мітапа за готівку
* Знайти _Bitcoin-банкомат_ у своєму районі, який продає біткоїни за готівку
* Продати товари або послуги за біткоїни
* Попросити свого работодавця або клієнтів заплатити біткоїнами

Усі ці методи мають різний ступінь складності, і багато з них передбачають сплату комісії. Деякі варіанти також вимагатимуть від Аліси надати документи, що посвідчують особу, щоб відповідати місцевим банківським вимогам. Так чи інакше за допомогою всіх цих методів Аліса зможе отримати біткоїни.

==== Отримання Біткоїнів

Припустимо, Аліса знайшла місцевий Біткоїн-банкомат і вирішила придбати біткоїни за готівку. Приклад Біткоїн-банкомату, створеного компанією Lamassu, наведено на зображенні <<bitcoin-atm>>. Такі Біткоїн-банкомати приймають готівку через купюроприймач та надсилають біткоїни на Біткоїн-адресу, відскановану з гаманця користувача за допомогою вбудованої камери.

[[bitcoin-atm]]
.Біткоїн-банкомат Lamassu
image:images/bitcoin-atm.png[]

Щоб покласти біткоїни у свій гаманець Eclair Lightning, Алісі потрібно надати банкомату _біткоїн-адресу_ з гаманця Eclair Lightning. Після чого банкомат зможе надіслати нещодавно придбані Алісою біткоїни на цю адресу.

Щоб побачити Біткоїн-адресу в гаманці Eclair, Аліса повинна свайпнути до лівої колонки під назвою "YOUR BITCOIN ADDRESS" (див. <<eclair-receive>>), де вона побачить квадратний штрих-код (який називається _QR-кодом_) та рядок букв і цифр під ним.

[[eclair-receive]]
.Біткоїн-адреса Аліси в Eclair
image:images/eclair-receive.png[]

QR-код містить той самий рядок букв і цифр, що написані під ним, але у зручному для сканування форматі. Таким чином, Алісі не потрібно вводити Біткоїн-адресу власноруч. На скріншоті <<eclair-receive>> ми навмисно розмили частину зображення, щоб запобігти ненавмисній відправці читачами біткоїнів на цю адресу.

[NOTE]
====
Як і Біткоїн-адреси, так і QR-коди містять додаткову інформацію, що допомагає виявити помилки ручного введення або сканування. Якщо в адресі є помилка, будь-який Біткоїн-гаманець помітить помилку та відмовиться приймати таку адресу.
====

Аліса може піднести свій смартфон до банкомату і показати його вбудованій камері, як показано на <<bitcoin-atm-receive>>. Вставивши трохи грошей в купюроприймач, вона отримає біткоїни в Eclair!

[[bitcoin-atm-receive]]
.Біткоїн-банкомат сканує QR-код
image:images/bitcoin-atm-receive.png[]

Аліса побачить транзакцію з банкомату на вкладці "TRANSACTION HISTORY" гаманця Eclair. Eclair побачить Біткоїн-транзакцію за кілька секунд, але для того, щоб транзакція була "підтверджена" у блокчейні, знадобиться приблизно одна година. Як ви можете бачити на скріншоті <<eclair-tx1>>, гаманець Eclair показує "6+ conf" під транзакцією. Це означає, що транзакція отримала необхідний мінімум у шість підтверджень, і тепер кошти готові до використання.

[[eclair-tx1]]
.Аліса отримує біткоїни
image:images/eclair-tx1-btc.png[]

В цьому прикладі для придбання своїх перших біткоїнів Аліса  використовувала банкомат, але якби вона використовувала будь-який інший метод <<acquiring-bitcoin>>, то в тому випадку застосовувалися б ті ж самі основні поняття. Наприклад, якщо Аліса хоче продати товар або надати професійну послугу в обмін на біткоїн, її клієнти можуть відсканувати її Біткоїн-адресу за допомогою своїх гаманців і заплатити їй біткоїнами.

Подібним чином, коли Аліса виставляє рахунок клієнту за послугу через Інтернет, вона може надіслати своєму клієнту е-мейл або повідомлення у мессенжер зі своєю Біткоїн-адресою або QR-кодом, щоб клієнт міг заплатити Алісі на цю адресу.

Аліса навіть могла б навіть роздрукувати QR-код і наклеїти його на гітару, щоб отримувати чайові під час виступу на вулиці!

Якщо Аліса придбала біткоїни на криптовалютній біржі, вона має «вивести» їх, вказавши свою Біткоїн-адресу на сайті біржі. Після чого біржа відправить біткоїни безпосередньо на її адресу.

=== From Bitcoin to Lightning Network

Alice's bitcoin is now controlled by her Eclair wallet and has been recorded on the Bitcoin blockchain. At this point, Alice's bitcoin is "on-chain," meaning that the transaction has been broadcast to the entire Bitcoin network, verified by all Bitcoin nodes, and "mined" (recorded) onto the Bitcoin blockchain.

So far, the Eclair Mobile wallet has behaved only as a Bitcoin wallet, and Alice hasn't used the Lightning Network features of Eclair. As is the case with many Lightning wallets, Eclair bridges Bitcoin and the Lightning Network by acting as both a Bitcoin wallet and a Lightning wallet.

Now, Alice is ready to start using the Lightning Network by taking her bitcoin "off-chain" in order to take advantage of the fast, cheap, and private payments that the Lightning Network offers.

==== Lightning Network Channels

Swiping right, Alice accesses the "LIGHTNING CHANNELS" section of Eclair. Here she can manage the channels that will connect her wallet to the Lightning Network.

Let's review the definition of a "Lightning Network Channel" at this point, to make things a bit clearer. Firstly, the word "channel" is a metaphor for a _financial relationship_ between Alice's Lightning wallet and another Lightning wallet. We call it a channel because it is a means for Alice's wallet and this other wallet to exchange many payments with each other on the Lightning Network (off-chain) without committing transactions to the Bitcoin blockchain (on-chain).

The wallet or _node_ that Alice opens a channel to is called her _channel peer_. Once "opened", a channel can be used to send many payments back and forth between Alice's wallet and her channel peer.

Furthermore, Alice's channel peer can _forward_ payments via other channels further into the Lightning Network. This way, Alice can _route_ a payment to any wallet (e.g. Bob's Lightning wallet) as long as Alice's wallet can find a _path_ made by hopping from channel to channel, all the way to Bob's wallet.

In other words: Alice needs one or more channels that connects her to one or more other nodes on the Lightning Network. She doesn't need a channel to connect her wallet directly to Bob's Cafe in order to send Bob a payment, though she can choose to open a direct channel too. Any node in the Lightning Network can be used for Alice's first channel. The more well-connected a node is the more people Alice can reach. In this example, since we want to also demonstrate payment routing, we won't have Alice open a channel directly to Bob's wallet. Instead, we will have Alice open a channel to a well-connected node and then later use that node to forward her payment, routing it through any other nodes as necessary to reach Bob.

At first, there are no open channels, so as we see in <<eclair-tutorial2.png>>, the "LIGHTNING CHANNELS" tab displays an empty list. If you notice, on the bottom right corner, there is a plus symbol (+), which is a button to open a new channel.

[[eclair-channels]]
.Lightning Channels Tab
image:images/eclair-tutorial2.png["Lightning Channels Tab"]

Alice presses the plus symbol and is presented with four possible ways to open a channel:

* Paste a node URI
* Scan a node URI
* Random node
* ACINQ node

A "node URI" is a Universal Resource Identifier (URI) that identifies a specific Lightning node. Alice can either paste such a URI from her clipboard or scan a QR code containing that same information. An example of a node URI is shown as a QR code in <<node-URI-QR>> and below it as a text string:

[[node-URI-QR]]
.node URI as a QR code
image:images/node-URI-QR.png[width=120]

[[node-URI-example]]
.node URI
++++
0237fefbe8626bf888de0cad8c73630e32746a22a2c4faa91c1d9877a3826e1174@1.ln.aantonop.com:9735
++++

While Alice could select a specific Lightning node, or use the "Random node" option to have the Eclair wallet select a node at random, she will select the "ACINQ Node" option to connect to one of ACINQ's well-connected Lightning nodes.

Choosing the ACINQ node will slightly reduce Alice's privacy, as it will give ACINQ the ability to see all of Alice's transactions. It will also create a Single Point of Failure, since Alice will only have one channel, and if the ACINQ node is not available, Alice will not be able to make payments. To keep things simple at first, we will accept these trade-offs. In subsequent chapters we will gradually learn how to gain more independence and make fewer trade-offs!

Alice selects "ACINQ Node" and is ready to open her first channel on the Lightning network.

==== Opening a Lightning Channel

When Alice selects a node to open a new channel, she is asked to select how much bitcoin she wants to allocate to this channel. In subsequent chapters, we will discuss the implications of these choices, but for now, Alice will allocate almost all her funds to the channel. Since she will have to pay transaction fees to open the channel, she will select an amount a few dollars (or a few thousandths of a bitcoin) less than her total balance.

Alice allocates 0.018BTC of her 0.020 total to her channel and accepts the default fee rate, as shown in <<eclair-open-channel>>.

[[eclair-open-channel]]
.Opening a Lightning Channel
image:images/eclair-open-channel-detail.png[]

Once she clicks "OPEN", her wallet constructs the special Bitcoin transaction that opens a Lightning channel, known as the _funding transaction_. The "on-chain" funding transaction is sent to the Bitcoin Network for confirmation.

Alice now has to wait again (see <<eclair-channel-waiting>>) for the transaction to be recorded on the Bitcoin blockchain. As with the initial Bitcoin transaction that she used to acquire her bitcoin, she has to wait for six or more confirmations (approximately one hour).

[[eclair-channel-waiting]]
.Waiting for the Funding Transaction to Open the Channel
image:images/eclair-channel-waiting.png["Waiting for the Funding Transaction to Open the Channel"]

Once the funding transaction is confirmed, Alice's channel to the ACINQ node is open, funded and ready, as shown in <<eclair-channel-open>>:

[[eclair-channel-open]]
.Channel is Open
image:images/eclair-channel-open.png["Channel is Open"]

[TIP]
====
Did you notice that the channel amount seems to have changed? It hasn't: the channel contains 0.018 BTC, but in the time between screenshots the BTC exchange rate changed, so the USD value is different. You can choose to show balances in BTC or USD, but keep in mind that USD values are calculated in real time and will change!
====

=== Buying a Cup of Coffee

Alice now has everything ready to start using the Lightning Network. As you can see, it took a bit of work and a bit of time waiting for confirmations. However, now subsequent actions are fast and easy. The Lightning Network enables payments without having to wait for confirmations, as funds get settled in seconds.

Alice grabs her mobile device and runs to Bob's Cafe in her neighborhood. She is excited to try her new Lightning wallet and use it to buy something!

==== Bob's Cafe

Bob has a simple Point-of-Sale (PoS) application for the use of any customer who wants to pay with bitcoin over the Lightning Network. As we will see in the next chapter, Bob uses the popular open source platform _BTCPay Server_ which contains all the necessary components for an e-commerce or retail solution, such as:

* A Bitcoin Node using the Bitcoin Core software
* A Lightning Node using the c-lightning software
* A simple PoS application for a tablet

BTCPay Server makes it simple to install all the necessary software, upload pictures and product prices, and launch a store quickly.

On the counter at Bob's Cafe, there is a tablet device showing <<bob-cafe-posapp>>:

[[bob-cafe-posapp]]
.Bob's Point-of-Sale Application
image:images/bob-cafe-posapp.png[]

==== A Lightning Invoice

Alice selects the "Cafe Latte" option from the screen and is presented with a _Lightning Invoice_ as shown in <<bob-cafe-invoice>>

[[bob-cafe-invoice]]
.Lightning Invoice for Alice's latte
image:images/bob-cafe-invoice.png[]

To pay the invoice, Alice opens her Eclair wallet and selects the "Send" button (which looks like a right-facing arrow) under the "TRANSACTION HISTORY" tab, as shown in <<alice-send-start>>.

[[alice-send-start]]
.Alice Send
image:images/alice-send-start.png[width=300]

Alice selects the option to "scan a payment request" and scans the QR code displayed on the screen of the tablet (see <<bob-cafe-invoice>>), and is prompted to confirm her payment, as shown in <<alice-send-detail>>:

[[alice-send-detail]]
.Alice's Send Confirmation
image:images/alice-send-detail.png[width=300]

Alice presses "PAY," and a second later, Bob's tablet shows a successful payment. Alice has completed her first Lightning Network payment! It was fast, inexpensive, and easy. Now she can enjoy her latte which was purchased using the most advanced payment technology in the world. And from now on, whenever Alice feels like drinking a coffee at Bob's Cafe she selects an item on Bob's tablet screen, scans the QR code with her cell phone, clicks pay and is served a coffee, all within seconds and all without "on-chain" transaction.


=== Conclusion

In this chapter, we followed Alice as she downloaded and installed her first Lightning wallet, acquired and transferred some bitcoin, opened her first Lightning channel, and bought a cup of coffee by making her first payment on the Lightning Network. In the following chapters, we will look "under the covers" at how each component in the Lightning Network works, and how Alice's payment reached Bob's Cafe.
